#{extends 'main.html'/}
#{set title:'GisWeb' /}
#{set 'moreStyles'}
	<link rel="stylesheet" href="@{'/public/stylesheets/jquery.datetimepicker.css'}" />
	<link rel="stylesheet" href="@{'/public/stylesheets/colpick.css'}" />
	<style type="text/css">
		.color-box {
			border: 1px solid black;
			display: inline-flex;
			height:10px;
			margin:5px;
			width:30px;
		}
	</style>
#{/set}
#{set 'moreScripts'}
	<script type="text/javascript" src="@{'/public/javascripts/jquery.slides.min.js'}"></script>
	<script type="text/javascript" src="@{'/public/javascripts/parsley.min.js'}"></script>
	<script type="text/javascript" src="@{'/public/javascripts/jquery.datetimepicker.js'}"></script>
	<script type="text/javascript" src="@{'/public/javascripts/colpick.js'}"></script>
#{/set}

#{form @Application.updatePoi(), method:"POST", id:"submitPoiData"}
	<div id="poi"></div>
	<label for="powerTag">power tag</label>
	<select name="powerTag" id="powerTag" class='submitPoiDataField'>
		<option value=""> </option>
		#{list items:models.Poi.getPowerTagFields(), as:"powerTag"}
			<option value="${powerTag.camelCase()}">${powerTag}</option>
		#{/list}
	</select>
	<div id="powerTagDetails"></div>
	<input type="text" id="poiId" name="poiId" value="${poiId}" readonly style="display: none;"/>
	<input id="submitPoiDataButton" type="submit" value="Save" style="display: none;"/>
#{/form}
<script type="text/javascript">


	$('#submitPoiData').parsley();

	$(document).ready(function(){
		var action = #{jsAction @poi(':poiId') /};
		$('#poi').load(
			action({poiId: ${poiId}})
		);
	});
	
	$('#powerTagDetails').on('click', '.color-box', function(){
		$('.color-box').colpick({colorScheme:'dark',
													layout:'rgbhex',
													color:'ff8800',
													onSubmit:function(hsb,hex,rgb,el) {$(el).css('background-color', '#'+hex);
																																	$(el).colpickHide();}})
													.css('background-color', '#ff8800');
	});

	$('#poi').on('click', '#poiTime', function(){
		$('#poiTime').datetimepicker({format:'Y/m/d H:i:s'});
	});

	$('#powerTagDetails').on('click', '#powerTagTime', function(){
		$('#powerTagTime').datetimepicker({format:'Y/m/d H:i:s'});
	});
	
	$("body").on('click', "input.submitPoiDataField", function(){
		$("#submitPoiDataButton").css("display","inline");
	});

	$("body").on('change', "select.submitPoiDataField", function(){
		$("#submitPoiDataButton").css("display","inline");
	});
	
	$('#powerTagDetails').on('change', '#source', function(){
		var action = #{jsAction @getMethodHtmlCode(':source', ':poiId') /};
		$('#generatorType').empty();
		if ($("#source").val() == "") {
			$('#generatorMethod').empty();
		}
		else {
			$.get(action({source: $("#source").val(), poiId: ${poiId}}), function(htmlContent) {
			if (htmlContent == "") {
				$('#generatorMethod').empty();
				action = #{jsAction @getTypeHtmlCode(':source', ':method', ':poiId') /};
				$('#generatorType').load(
					action({source: $("#source").val(), method: "NULL", poiId: ${poiId}})
				);
			}
			else {
			$('#generatorMethod').html(
				htmlContent
			);
			};
			});
		};
	});
	
	$('#powerTagDetails').on('change', '#method', function(){
		var action = #{jsAction @getTypeHtmlCode(':source', ':method', ':poiId') /};
		if ($("#method").val() == "") {
			$('#generatorType').empty();
		}
		else {
			$('#generatorType').load(
				action({source: $("#source").val(), method: $("#method").val(), poiId: ${poiId}})
			);
		};
	});
	
	$("#powerTag").change(function(){
		var action = #{jsAction @powerTagDetails(':powerTag', ':poiId') /};
		if ($("#powerTag").val() == "") {
			$('#powerTagDetails').empty();
		}
		else {
			$('#powerTagDetails').load(
				action({powerTag: $("#powerTag").val(), poiId: ${poiId}})
			);
		};
	});
</script>