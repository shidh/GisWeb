#{extends 'main.html' /}
#{set title:'grid2osm' /}
#{set 'moreScripts'}
	#{get 'moreScripts' /}
	<script>
		var row_top_collapsed = true;
		function showPoi(poiId) {
			if (row_top_collapsed) {
				row_top_collapsed = false;
				var action = #{jsAction @getPoi(':poiId') /};
				$('#row_top').collapse('show');
				$('#poi').load(action({poiId: poiId}));
			}
		};
		$(document).on('change', '#poi_power_tag', function() {
			if ($('#poi_power_tag').val() == "") {
				$('#poi_power_tag_details').empty();
			} else {
				var action = #{jsAction @getPoiPowerTag(':poiId', ':powerTag') /};
				var powerTag = $('#poi_power_tag').val().replace(/ /g, '_').toLowerCase();
				$('#poi_power_tag_details').load(action({poiId: 1, powerTag: powerTag}));
			};
		});
		$(document).on('change', '#source', function() {
			if ($('#source').val() == "") {
				$('#generator_method').empty();
			} else {
				var action = #{jsAction @getPoiPowerTagGeneratorMethod(':poiId', ':source') /};
				var source = $('#source').val().replace(/ /g, '_').toLowerCase();
				$('#generator_method').load(action({poiId: 1, source: source}));
			}
		});
		$(document).on('change', '#method', function() {
			if ($('#method').val() == "") {
				$('#generator_type').empty();
			} else {
				var action = #{jsAction @getPoiPowerTagGeneratorType(':poiId', ':sourceMethod') /};
				var source = $('#source').val().replace(/ /g, '_').toLowerCase();
				var method = $('#method').val().replace(/ /g, '_').toLowerCase();
				$('#generator_type').load(action({poiId: 1, sourceMethod: source + '_' + method}));
			}
		});
	</script>
#{/set}
#{bootstrap /}
#{web_socket /}
<div id='table' class='container-fluid'>
	<div id='row_top' class='collapse row'>
		<div id='poi' class='col-xs-12'>
		</div>
	</div>
	<div id='row_middle' class='row'>
		<div class='col-xs-12'>
			#{map /}
		</div>
	</div>
	<div id='row_bottom' class='collapse row'>
		<div id='photo' class='col-xs-12'>
		</div>
	</div>
</div>
<script type='text/javascript'>
	(function() {
	#{list items:pois, as:'poi'}
	addMarker(${poi.id}, ${poi.latitude}, ${poi.longitude});
	#{/list}
	})();
</script>