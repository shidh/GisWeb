#{extends 'main.html'/}
#{set title:'GisWeb' /}
#{set 'moreStyles'}
	<link rel="stylesheet" href="@{'/public/stylesheets/leaflet.css'}" />
	<link rel="stylesheet" href="@{'/public/stylesheets/osm2leaflet.css'}" />
#{/set}
#{set 'moreScripts'}
	<script type="text/javascript" src="@{'/public/javascripts/leaflet.js'}"></script>
	<script type="text/javascript" src="@{'/public/javascripts/jquery.slides.min.js'}"></script>
	<script type="text/javascript">
		var map;
		var ajaxRequest;
		var plotlist;
		var plotlayers=[];

		function initmap() {
			// set up the map
			map = new L.Map('map');
			var customIcon = L.icon({
				iconUrl: '/public/images/marker-icon.png',
				shadownUrl: '/public/iamges/marker-shadow.png',
				iconSize:[25,41],
				iconAnchor:[12,41],
				popupAnchor:[1,-34],
				shadowSize: [41, 41]});

			// create the tile layer with correct attribution
			var osmUrl='//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
			var osmAttrib='Map data Â© <a href="//openstreetmap.org">OpenStreetMap</a> contributors';
			var osm = new L.TileLayer(osmUrl, {minZoom: 1, maxZoom: 19, attribution: osmAttrib});		

			// start the map
			map.setView(new L.LatLng(51.163375, 10.447683),8);
			map.addLayer(osm);

			#{list items:models.Poi.findAll(), as:'poi'}
				var marker = L.marker([${poi.latitude}, ${poi.longitude}], {icon: customIcon}).addTo(map);
				var content =	'<div id="slides${poi.id}">' +
								#{list items:0..poi.photos.size()-1, as:'index'}
									'<img width="200px" src="@{Application.getPicture(poi.id, index)}"/>' +
								#{/list}
								'</div>' +
								'#{CustomTag.form @Application.editPoi(), method:"POST", id:"editPoi"}' +
									'<input type="text" id="poiId" name="poiId" value="${poi.id}" readonly style="display: none;"/>' +
									'<input id="editPoiDataButton" type="submit" value="Edit" />\#{/CustomTag.form}';
				marker.bindPopup(content);
				marker.on('click', function(){
					$("#slides${poi.id}").slidesjs({
						pagination: {
							active: false
						}
					});
				});
			#{/list}
		}
	</script>
#{/set}

<div id="map"></div>
<script type="text/javascript">
	initmap();
</script>
